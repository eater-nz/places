box: openjdk:8-jdk

build:
  steps:
      - script:
          name: prepare folder
          code: |
              rm wercker.yml
              mkdir input
              shopt -s extglob
              mv !(input) input/
              mkdir output
      - script:
          name: get generator
          code: |
              git clone --depth 1 https://github.com/eater-nz/api-generator generator
      - wercker/maven:
          cwd: ./generator/
          goals: clean compile exec:java
          cache_repo: true
          version: 3.5.2
      - script:
          name: publish data
          code: |
              ls -la ./input/
              git clone https://github.com/eater-nz/api-eater-nz api
              cd api
              git config user.email "`git --git-dir ../input/.git log -1 --pretty=%aN`"
              git config user.email "`git --git-dir ../input/.git log -1 --pretty=%ae`"
              cp ../output/places.json .
              git add .
              git commit -m "`git --git-dir ../input/.git log -1 --pretty=%B` (autocommit)"
              git log
